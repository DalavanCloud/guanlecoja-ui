{"version":3,"file":"scripts.js","sources":["module/main.module.coffee","module/breadcrumb_service/breadcrumb.service.coffee","module/menu_service/menu.service.coffee","module/notification_service/httpinterceptor.coffee","module/notification_service/notification.service.coffee","module/notification_widget/notification.directive.coffee","module/page_with_sidebar/page_with_sidebar.directive.coffee","module/topbar/topbar.directive.coffee","guanlecoja.ui/views/notification.html","guanlecoja.ui/views/page_with_sidebar.html","guanlecoja.ui/views/topbar.html"],"names":[],"mappings":"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","sourcesContent":["# first thing, we install underscore.string inside lodash\n_.mixin(_.str.exports())\n\nangular.module(\"guanlecoja.ui\", [\"ui.bootstrap\", \"ui.router\", \"ngAnimate\"])\n","# a simple service to abstract breadcrumb configuration\nclass glBreadcrumb extends Service\n    constructor: (@$rootScope) -> {}\n\n    setBreadcrumb: (breadcrumb) ->\n        @$rootScope.$broadcast(\"glBreadcrumb\", breadcrumb)\n\n","class GlMenu extends Provider\n    constructor: ->\n        @groups = {}\n        @footer = []\n\n    appTitle: \"set AppTitle using GlMenuServiceProvider.setAppTitle\"\n\n    addGroup: (group) ->\n        group.items = []\n        group.order ?= 99\n        @groups[group.name] = group\n        return @groups\n\n    setFooter: (footer) ->\n        @footer = footer\n\n    setAppTitle: (title) ->\n        @appTitle = title\n\n    $get: [\"$state\", ($state) ->\n        for state in $state.get()[1...]\n            group = state.data.group\n            unless group?\n                continue\n\n            unless @groups.hasOwnProperty(group)\n                throw Error(\"group #{group} has not been defined with glMenuProvider.group(). has: #{_.keys(@groups)}\")\n\n            @groups[group].items.push\n                caption: state.data.caption || _.string.humanize(state.name)\n                sref: state.name\n\n        for name, group of @groups\n            # if a group has only no item, we juste delete it\n            if group.items.length == 0 and not group.separator\n                delete @groups[name]\n            # if a group has only one item, then we put the group == the item\n            else if group.items.length == 1\n                item = group.items[0]\n                group.caption = item.caption\n                group.sref = item.sref\n                group.items = []\n            else\n                group.sref = \".\"\n        groups = _.values(@groups)\n        groups.sort((a,b) -> a.order - b.order)\n        self = @\n        return {\n            getGroups: -> groups\n            getFooter: -> self.footer\n            getAppTitle: -> self.appTitle\n        }\n    ]\n","# I intercept the http errors and put them in the notification service\nclass AddInterceptor extends Config\n    constructor: ($httpProvider) ->\n        $httpProvider.responseInterceptors.push('glHttpInterceptor')\n\nclass glHttpInterceptor extends Factory\n    constructor: (glNotificationService, $q, $timeout) ->\n        return (promise) ->\n            errorHandler =  (res) ->\n                try\n                    msg = \"#{res.status}:#{res.data.error} \" +\n                    \"when:#{res.config.method} #{res.config.url}\"\n                catch e\n                    msg = res.toString()\n                $timeout((-> glNotificationService.network(msg)), 100)\n                $q.reject res\n\n            promise.then(angular.identity, errorHandler)\n","class glNotification extends Service\n    constructor: (@$rootScope, @$timeout) ->\n        @notifications = []\n        @curid = 0\n        null\n\n    notify: (opts) ->\n        @curid += 1\n        opts.title ?= \"Info\"\n        opts.id = @curid\n        id = @curid\n        if opts.group?\n            for i, n of @notifications\n                if opts.group == n.group\n                    id = i\n                    n.msg += \"\\n\" + opts.msg\n        if id == @curid\n            @notifications.push opts\n        null\n\n    # some shortcuts...\n    error: (opts) ->\n        opts.title ?= \"Error\"\n        @notify(opts)\n\n    network: (opts) ->\n        opts.title ?= \"Network issue\"\n        opts.group ?= \"Network\"\n        @notify(opts)\n\n    dismiss: (id) ->\n        for i, n of @notifications\n            if n.id == id\n                @notifications.splice(i, 1)\n                return null\n        null\n","class GlNotification extends Directive\n    constructor: ->\n        return {\n            replace: true\n            transclude: true\n            restrict: 'E'\n            scope: false\n            controllerAs: \"n\"\n            templateUrl: \"guanlecoja.ui/views/notification.html\"\n            controller: \"_glNotificationController\"\n        }\n\nclass _glNotification extends Controller\n\n    constructor: (@$scope, @glNotificationService, @dropdownService) ->\n        @notifications = @glNotificationService.notifications\n        null\n\n    dismiss: (id, e) ->\n        @glNotificationService.dismiss(id)\n        e.stopPropagation()\n        null\n    toggle: ->\n        @$scope.isOpen = true\n        @dropdownService.open(@$scope)\n        null\n","class GlPageWithSidebar extends Directive\n    constructor: ->\n        return {\n            replace: true\n            transclude: true\n            restrict: 'E'\n            scope: false\n            controllerAs: \"page\"\n            templateUrl: \"guanlecoja.ui/views/page_with_sidebar.html\"\n            controller: \"_glPageWithSidebarController\"\n        }\n\nclass _glPageWithSidebar extends Controller\n    constructor: (@$scope, glMenuService, @$timeout) ->\n        @sidebarPinned = false\n        @groups = glMenuService.getGroups()\n        @footer = glMenuService.getFooter()\n        @appTitle = glMenuService.getAppTitle()\n        @activeGroup = null\n        @inSidebar = false\n        @sidebarActive = false\n\n    toggleGroup: (group) ->\n        if @activeGroup!=group\n            @activeGroup=group\n        else\n            @activeGroup=null\n\n    enterSidebar: ->\n        @sidebarActive = true\n        @inSidebar = true\n\n    hideSidebar: ->\n        @sidebarActive = false\n        @inSidebar = false\n\n    leaveSidebar: ->\n        @inSidebar = false\n        if @timeout?\n            @$timeout.cancel(@timeout)\n            @timeout = undefined\n        @timeout = @$timeout (=>\n            unless @inSidebar or @sidebarPinned\n                @sidebarActive = false\n                @activeGroup = null\n            ), 500\n\n","class GlTopbar extends Directive\n    constructor: ->\n        return {\n            replace: true\n            transclude: true\n            restrict: 'E'\n            scope: false\n            controllerAs: \"page\"\n            templateUrl: \"guanlecoja.ui/views/topbar.html\"\n            controller: \"_glTopbarController\"\n        }\n\nclass _glTopbar extends Controller\n    constructor: ($scope, glMenuService, $location) ->\n        groups = glMenuService.getGroups()\n        groups = _.zipObject(_.map(groups, (g) -> g.name), groups)\n        $scope.appTitle = glMenuService.getAppTitle()\n\n        $scope.$on \"$stateChangeStart\", (ev, state) ->\n            $scope.breadcrumb = []\n            if state.data?.group\n                $scope.breadcrumb.push\n                    caption: groups[state.data.group].caption\n            $scope.breadcrumb.push\n                caption: state.data?.caption or _.humanize(state.name)\n                href: '#' + $location.hash()\n\n        $scope.$on \"glBreadcrumb\", (e, data) ->\n            $scope.breadcrumb = data\n","li.dropdown.notifications(ng-class=\"{ active: isOpen }\")\n    a(ng-click=\"n.toggle()\")\n        i.fa.fa-bell-o.fa-lg(ng-class=\"{'fa-ringing': n.notifications.length > 0 }\")\n    ul.dropdown-menu.dropdown-menu-right\n        li.dropdown-header\n            | Notifications\n        li.divider\n        div(ng-repeat=\"msg in n.notifications\")\n          li\n            .item\n                button.close(ng-click=\"n.dismiss(msg.id, $event)\") &times;\n                .title {{msg.title}}:\n                .msg {{msg.msg}}\n          li.divider\n        li(ng-hide=\"n.notifications.length>0\")\n            .item\n                small.msg  all caught up!\n",".gl-page-with-sidebar(ng-class=\"{'active': page.sidebarActive, 'pinned': page.sidebarPinned}\")\n    .sidebar.sidebar-blue(ng-mouseenter='page.enterSidebar()',ng-mouseleave='page.leaveSidebar()')\n        ul\n            li.sidebar-main\n                a(href='#')\n                    | {{page.appTitle}}\n                    span.menu-icon.fa.fa-bars(ng-hide=\"page.sidebarActive\", ng-click='page.sidebarActive=!page.sidebarActive')\n                    span.menu-icon.fa.fa-thumb-tack(ng-show=\"page.sidebarActive\", ng-click=\"page.sidebarPinned=!page.sidebarPinned\", ng-class=\"{'fa-45': !page.sidebarPinned}\")\n            li.sidebar-title\n                span NAVIGATION\n            div(ng-repeat=\"group in page.groups\")\n                div(ng-if=\"group.items.length > 0\")\n                    li.sidebar-list\n                        a(ng-click='page.toggleGroup(group)')\n                            i.fa.fa-angle-right\n                            | &nbsp;{{group.caption}}\n                            span.menu-icon.fa(ng-class=\"'fa-' + group.icon\")\n                    li.sidebar-list.subitem(ng-class=\"{'active': page.activeGroup==group}\", ng-repeat=\"item in group.items\")\n                        a(ui-sref='{{item.sref}}', ng-click='page.hideSidebar()')\n                            | {{item.caption}}\n                div(ng-if=\"group.items.length == 0\")\n                    div(ng-if=\"group.separator\")\n                        li.sidebar-title\n                            span {{group.caption}}\n                    div(ng-if=\"!group.separator\")\n                        li.sidebar-separator(ng-if=\"!$first\")\n                        li.sidebar-list\n                            a(ui-sref='{{group.sref}}', ng-click='page.toggleGroup(group)')\n                                | {{group.caption}}\n                                span.menu-icon.fa(ng-class=\"'fa-' + group.icon\")\n        .sidebar-footer\n            .col-xs-4(ng-repeat=\"item in page.footer\")\n                a(ng-href='{{item.href}}')\n                    | {{item.caption}}\n    .content\n        div(ng-transclude)\n",".navbar.navbar-default.navbar-static-top\n    .container-fluid\n        a.navbar-brand {{appTitle}}\n        ol.breadcrumb\n            li(ng-repeat=\"b in breadcrumb\")\n                a(ng-if=\"b.sref\", ui-sref=\"{{b.sref}}\") {{b.caption}}\n                a(ng-if=\"b.href\", ng-href=\"{{b.href}}\") {{b.caption}}\n                span(ng-if=\"b.href == undefined && b.sref == undefined\", ng-href=\"{{b.href}}\") {{b.caption}}\n        ul.nav.navbar-nav.pull-right(ng-transclude)\n\n"],"sourceRoot":"/source/"}